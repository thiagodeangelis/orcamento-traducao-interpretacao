<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orçamento - Serviços de Libras</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <link rel="stylesheet" href="css/style-orcamento.css">
</head>
<body>

    <div class="orcamento-container">

        <!-- Cabeçalho da Empresa -->
        <div class="header-empresa">
            <i class="bi bi-award-fill logo-empresa"></i>
            <h1 class="titulo-orcamento">ORÇAMENTO DE SERVIÇO</h1>
            <p class="text-muted mb-0">Tradução e Interpretação em Libras</p>
        </div>

        <!-- Conteúdo do Orçamento -->
        <div id="dadosOrcamento"></div>

        <!-- Data de Emissão -->
        <div class="data-emissao">
            <small><i class="bi bi-calendar3"></i> Emitido em: <span id="dataEmissao"></span></small>
        </div>

        <!-- Botões de Ação -->
        <div class="btn-actions">
            <button onclick="window.print()" class="btn btn-success flex-fill">
                <i class="bi bi-printer me-2"></i> Imprimir Orçamento
            </button>
            <a href="index.html" class="btn btn-outline-primary flex-fill">
                <i class="bi bi-arrow-left me-2"></i> Novo Orçamento
            </a>
        </div>

    </div>

    <script>
        // Exibir data de emissão
        const dataAtual = new Date();
        const dia = dataAtual.getDate();
        const mes = dataAtual.getMonth();
        const ano = dataAtual.getFullYear();
        
        const meses = ["janeiro", "fevereiro", "março", "abril", "maio", "junho", 
                       "julho", "agosto", "setembro", "outubro", "novembro", "dezembro"];
        
        const dataFormatada = dia + " de " + meses[mes] + " de " + ano;
        document.getElementById('dataEmissao').textContent = dataFormatada;

        // Obter parâmetros da URL
        const parametros = new URLSearchParams(window.location.search);
        const servico = parametros.get("servico");
        const bloco = document.getElementById("dadosOrcamento");

        // Função para criar item de informação
        function criarItem(label, valor) {
            let htmlItem = '';
            
            if (valor.includes("~ Não se aplica ~")) {
                // Quando for "Não se aplica", mostra o label e o valor centralizado
                htmlItem = '<div class="info-item"><span class="info-label">' + label + '</span><span class="info-value nao-aplica">' + valor + '</span></div>';
            } else {
                htmlItem = '<div class="info-item"><span class="info-label">' + label + '</span><span class="info-value">' + valor + '</span></div>';
            }
            
            return htmlItem;
        }

        // Função para converter minutos em horas e minutos
        function converterMinutosEmHorasMinutos(minutos) {
            const horas = Math.floor(minutos / 60);
            const minutosRestantes = minutos % 60;
            
            let resultado = "";
            
            if (horas > 0) {
                resultado = horas + "h";
            }
            
            if (minutosRestantes > 0) {
                if (resultado !== "") {
                    resultado = resultado + " " + minutosRestantes + "min";
                } else {
                    resultado = minutosRestantes + "min";
                }
            }
            
            if (resultado === "") {
                resultado = "0min";
            }
            
            return resultado;
        }

        // ORÇAMENTO DE INTERPRETAÇÃO
        if (servico === "interpretacao") {
            const nome = parametros.get("nomeEvento");
            const tipo = parametros.get("tipoEvento");
            const tempo = Number(parametros.get("tempoEvento"));
            const endereco = parametros.get("endereco");
            const gravadoTexto = parametros.get("gravado");
            
            let gravado = "";
            if (gravadoTexto === "true") {
                gravado = "Sim";
            } else {
                gravado = "Não";
            }

            const valorHora = Number(parametros.get("valorHora"));
            const qtd = Number(parametros.get("qtdInterpretes"));
            const totalHoras = Number(parametros.get("totalHoras"));
            const porcentagem = Number(parametros.get("porcentagemDireito"));
            const valorDireito = Number(parametros.get("valorDireito"));
            const impostos = Number(parametros.get("impostos"));
            const totalFinal = Number(parametros.get("totalFinal"));
            
            const duracaoFormatada = converterMinutosEmHorasMinutos(tempo);

            bloco.innerHTML = '<div class="info-section"><h5><i class="bi bi-mic-fill"></i> Informações do Evento</h5>' +
                criarItem("Nome do Evento", nome) +
                criarItem("Tipo do Evento", tipo) +
                criarItem("Duração", duracaoFormatada) +
                criarItem("Endereço", endereco) +
                criarItem("Evento Gravado", gravado) +
                '</div>' +
                '<div class="calculo-section"><h5 class="text-primary"><i class="bi bi-calculator"></i> Cálculo Detalhado</h5>' +
                criarItem("Valor por hora/intérprete", "R$ " + valorHora.toFixed(2)) +
                criarItem("Quantidade de intérpretes", qtd + " profissional(is)") +
                criarItem("Tempo total", duracaoFormatada) +
                criarItem("Subtotal (Horas)", "R$ " + totalHoras.toFixed(2)) +
                criarItem("Direito de Imagem (" + porcentagem + "%)", "R$ " + valorDireito.toFixed(2)) +
                criarItem("Impostos (15,5%)", "R$ " + impostos.toFixed(2)) +
                '</div>' +
                '<div class="total-final"><small>VALOR TOTAL DO ORÇAMENTO</small>R$ ' + totalFinal.toFixed(2) + '</div>';
        }

        // ORÇAMENTO DE TRADUÇÃO
        if (servico === "traducao") {
            const titulo = parametros.get("tituloMaterial");
            const tipo = parametros.get("tipoMaterial");
            const tempo = Number(parametros.get("tempoMinutos"));
            const legendaTexto = parametros.get("legendagem");
            
            let legenda = "";
            if (legendaTexto === "true") {
                legenda = "Sim";
            } else {
                legenda = "Não";
            }
            
            const edicao = parametros.get("tipoEdicao");
            const descricao = parametros.get("descricao");

            const valorMinuto = Number(parametros.get("valorMinuto"));
            const total = Number(parametros.get("valorTotal"));
            const porcentagem = Number(parametros.get("porcentagemDireito"));
            const valorDireito = Number(parametros.get("valorDireito"));
            const impostos = Number(parametros.get("impostos"));
            const totalFinal = Number(parametros.get("totalFinal"));
            
            const duracaoFormatada = converterMinutosEmHorasMinutos(tempo);
            
            let descricaoHTML = "";
            if (descricao !== "Nenhuma descrição fornecida") {
                descricaoHTML = criarItem("Descrição", descricao);
            }

            bloco.innerHTML = '<div class="info-section"><h5><i class="bi bi-film"></i> Informações do Material</h5>' +
                criarItem("Título do Material", titulo) +
                criarItem("Tipo de Material", tipo) +
                criarItem("Duração", duracaoFormatada) +
                criarItem("Legendagem", legenda) +
                criarItem("Tipo de Edição", edicao) +
                descricaoHTML +
                '</div>' +
                '<div class="calculo-section"><h5 class="text-primary"><i class="bi bi-calculator"></i> Cálculo Detalhado</h5>' +
                criarItem("Valor por minuto", "R$ " + valorMinuto.toFixed(2)) +
                criarItem("Tempo total", duracaoFormatada) +
                criarItem("Subtotal", "R$ " + total.toFixed(2)) +
                criarItem("Direito de Imagem (" + porcentagem + "%)", "R$ " + valorDireito.toFixed(2)) +
                criarItem("Impostos (15,5%)", "R$ " + impostos.toFixed(2)) +
                '</div>' +
                '<div class="total-final"><small>VALOR TOTAL DO ORÇAMENTO</small>R$ ' + totalFinal.toFixed(2) + '</div>';
        }
    </script>

</body>
</html>