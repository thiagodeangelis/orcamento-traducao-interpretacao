<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orçamento - Serviços de Libras</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
        body {
            background: linear-gradient(to bottom right, #eef3ff, #ffffff);
        }

        .orcamento-container {
            max-width: 850px;
            margin: 20px auto;
            background: white;
            padding: 30px 40px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
        }

        .header-empresa {
            text-align: center;
            border-bottom: 2px solid #0d6efd;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .logo-empresa {
            font-size: 36px;
            color: #0d6efd;
        }

        .titulo-orcamento {
            font-weight: 700;
            color: #0d6efd;
            font-size: 26px;
            margin-top: 8px;
            margin-bottom: 5px;
        }

        .info-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .info-section h5 {
            color: #0d6efd;
            font-weight: 700;
            margin-bottom: 12px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-item {
            padding: 6px 0;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #495057;
        }

        .info-value {
            color: #212529;
            text-align: right;
        }

        /* Estilo especial para "Não se aplica" */
        .info-value.nao-aplica {
            color: #6c757d;
            font-style: italic;
            text-align: right;
        }

        .calculo-section {
            background: #fff;
            border: 2px solid #0d6efd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .total-final {
            background: linear-gradient(135deg, #0d6efd 0%, #0056b3 100%);
            color: white;
            padding: 18px;
            font-size: 24px;
            font-weight: 700;
            border-radius: 12px;
            text-align: center;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(13, 110, 253, 0.3);
        }

        .total-final small {
            font-size: 14px;
            font-weight: 400;
            display: block;
            margin-bottom: 3px;
            opacity: 0.9;
        }

        .btn-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .data-emissao {
            text-align: right;
            color: #6c757d;
            font-size: 12px;
            margin-top: 15px;
        }

        @media print {
            body {
                background: white;
            }
            .orcamento-container {
                box-shadow: none;
                padding: 20px;
                margin: 0;
                max-width: 100%;
            }
            .btn-actions {
                display: none;
            }
            .header-empresa {
                padding-bottom: 10px;
                margin-bottom: 15px;
            }
            .info-section {
                padding: 10px;
                margin-bottom: 10px;
            }
            .calculo-section {
                padding: 10px;
                margin-bottom: 10px;
            }
            .total-final {
                padding: 15px;
                margin-top: 15px;
            }
        }

        @media (max-width: 768px) {
            .orcamento-container {
                padding: 25px 20px;
            }
            .titulo-orcamento {
                font-size: 22px;
            }
            .btn-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

    <div class="orcamento-container">

        <!-- Cabeçalho da Empresa -->
        <div class="header-empresa">
            <i class="bi bi-award-fill logo-empresa"></i>
            <h1 class="titulo-orcamento">ORÇAMENTO DE SERVIÇO</h1>
            <p class="text-muted mb-0" style="font-size: 14px;">Tradução e Interpretação em Libras</p>
        </div>

        <!-- Conteúdo do Orçamento -->
        <div id="dadosOrcamento"></div>

        <!-- Data de Emissão -->
        <div class="data-emissao">
            <small><i class="bi bi-calendar3"></i> Emitido em: <span id="dataEmissao"></span></small>
        </div>

        <!-- Botões de Ação -->
        <div class="btn-actions">
            <button onclick="window.print()" class="btn btn-success flex-fill">
                <i class="bi bi-printer me-2"></i> Imprimir Orçamento
            </button>
            <a href="index.html" class="btn btn-outline-primary flex-fill">
                <i class="bi bi-arrow-left me-2"></i> Novo Orçamento
            </a>
        </div>

    </div>

    <script>
        // Exibir data de emissão
        const dataAtual = new Date();
        const dia = dataAtual.getDate();
        const mes = dataAtual.getMonth();
        const ano = dataAtual.getFullYear();
        
        const meses = ["janeiro", "fevereiro", "março", "abril", "maio", "junho", 
                       "julho", "agosto", "setembro", "outubro", "novembro", "dezembro"];
        
        const dataFormatada = dia + " de " + meses[mes] + " de " + ano;
        document.getElementById('dataEmissao').textContent = dataFormatada;

        // Obter parâmetros da URL
        const parametros = new URLSearchParams(window.location.search);
        const servico = parametros.get("servico");
        const bloco = document.getElementById("dadosOrcamento");

        // Função para criar item de informação
        function criarItem(label, valor) {
            let htmlItem = '';
            
            if (valor.includes("~ Não se aplica ~")) {
                // Quando for "Não se aplica", mostra o label e o valor centralizado
                htmlItem = '<div class="info-item"><span class="info-label">' + label + '</span><span class="info-value nao-aplica">' + valor + '</span></div>';
            } else {
                htmlItem = '<div class="info-item"><span class="info-label">' + label + '</span><span class="info-value">' + valor + '</span></div>';
            }
            
            return htmlItem;
        }

        // Função para converter minutos em horas e minutos
        function converterMinutosEmHorasMinutos(minutos) {
            const horas = Math.floor(minutos / 60);
            const minutosRestantes = minutos % 60;
            
            let resultado = "";
            
            if (horas > 0) {
                resultado = horas + "h";
            }
            
            if (minutosRestantes > 0) {
                if (resultado !== "") {
                    resultado = resultado + " " + minutosRestantes + "min";
                } else {
                    resultado = minutosRestantes + "min";
                }
            }
            
            if (resultado === "") {
                resultado = "0min";
            }
            
            return resultado;
        }

        // ORÇAMENTO DE INTERPRETAÇÃO
        if (servico === "interpretacao") {
            const nome = parametros.get("nomeEvento");
            const tipo = parametros.get("tipoEvento");
            const tempo = Number(parametros.get("tempoEvento"));
            const endereco = parametros.get("endereco");
            const gravadoTexto = parametros.get("gravado");
            
            let gravado = "";
            if (gravadoTexto === "true") {
                gravado = "Sim";
            } else {
                gravado = "Não";
            }

            const valorHora = Number(parametros.get("valorHora"));
            const qtd = Number(parametros.get("qtdInterpretes"));
            const totalHoras = Number(parametros.get("totalHoras"));
            const porcentagem = Number(parametros.get("porcentagemDireito"));
            const valorDireito = Number(parametros.get("valorDireito"));
            const impostos = Number(parametros.get("impostos"));
            const totalFinal = Number(parametros.get("totalFinal"));
            
            const duracaoFormatada = converterMinutosEmHorasMinutos(tempo);

            bloco.innerHTML = '<div class="info-section"><h5><i class="bi bi-mic-fill"></i> Informações do Evento</h5>' +
                criarItem("Nome do Evento", nome) +
                criarItem("Tipo do Evento", tipo) +
                criarItem("Duração", duracaoFormatada) +
                criarItem("Endereço", endereco) +
                criarItem("Evento Gravado", gravado) +
                '</div>' +
                '<div class="calculo-section"><h5 class="text-primary"><i class="bi bi-calculator"></i> Cálculo Detalhado</h5>' +
                criarItem("Valor por hora/intérprete", "R$ " + valorHora.toFixed(2)) +
                criarItem("Quantidade de intérpretes", qtd + " profissional(is)") +
                criarItem("Tempo total", duracaoFormatada) +
                criarItem("Subtotal (Horas)", "R$ " + totalHoras.toFixed(2)) +
                criarItem("Direito de Imagem (" + porcentagem + "%)", "R$ " + valorDireito.toFixed(2)) +
                criarItem("Impostos (15,5%)", "R$ " + impostos.toFixed(2)) +
                '</div>' +
                '<div class="total-final"><small>VALOR TOTAL DO ORÇAMENTO</small>R$ ' + totalFinal.toFixed(2) + '</div>';
        }

        // ORÇAMENTO DE TRADUÇÃO
        if (servico === "traducao") {
            const titulo = parametros.get("tituloMaterial");
            const tipo = parametros.get("tipoMaterial");
            const tempo = Number(parametros.get("tempoMinutos"));
            const legendaTexto = parametros.get("legendagem");
            
            let legenda = "";
            if (legendaTexto === "true") {
                legenda = "Sim";
            } else {
                legenda = "Não";
            }
            
            const edicao = parametros.get("tipoEdicao");
            const descricao = parametros.get("descricao");

            const valorMinuto = Number(parametros.get("valorMinuto"));
            const total = Number(parametros.get("valorTotal"));
            const porcentagem = Number(parametros.get("porcentagemDireito"));
            const valorDireito = Number(parametros.get("valorDireito"));
            const impostos = Number(parametros.get("impostos"));
            const totalFinal = Number(parametros.get("totalFinal"));
            
            const duracaoFormatada = converterMinutosEmHorasMinutos(tempo);
            
            let descricaoHTML = "";
            if (descricao !== "Nenhuma descrição fornecida") {
                descricaoHTML = criarItem("Descrição", descricao);
            }

            bloco.innerHTML = '<div class="info-section"><h5><i class="bi bi-film"></i> Informações do Material</h5>' +
                criarItem("Título do Material", titulo) +
                criarItem("Tipo de Material", tipo) +
                criarItem("Duração", duracaoFormatada) +
                criarItem("Legendagem", legenda) +
                criarItem("Tipo de Edição", edicao) +
                descricaoHTML +
                '</div>' +
                '<div class="calculo-section"><h5 class="text-primary"><i class="bi bi-calculator"></i> Cálculo Detalhado</h5>' +
                criarItem("Valor por minuto", "R$ " + valorMinuto.toFixed(2)) +
                criarItem("Tempo total", duracaoFormatada) +
                criarItem("Subtotal", "R$ " + total.toFixed(2)) +
                criarItem("Direito de Imagem (" + porcentagem + "%)", "R$ " + valorDireito.toFixed(2)) +
                criarItem("Impostos (15,5%)", "R$ " + impostos.toFixed(2)) +
                '</div>' +
                '<div class="total-final"><small>VALOR TOTAL DO ORÇAMENTO</small>R$ ' + totalFinal.toFixed(2) + '</div>';
        }
    </script>

</body>
</html>